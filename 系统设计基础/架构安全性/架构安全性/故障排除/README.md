<!--
 * @Author: shgopher shgopher@gmail.com
 * @Date: 2025-04-04 22:47:58
 * @LastEditors: shgopher shgopher@gmail.com
 * @LastEditTime: 2025-04-10 16:12:40
 * @FilePath: /luban/系统设计基础/架构安全性/架构安全性/故障排除/README.md
 * @Description: 
 * 
 * Copyright (c) 2025 by shgopher, All Rights Reserved. 
-->
# 故障排除

故障排除第一定律：**减少故障影响范围，恢复正常运行**
## 恢复正常
我们通常有以下手段来恢复系统的正常运行：
- 重启和限流，重启可以解决可用性的问题，限流基本上要使用限流中间件。
- 回滚，为了解决新版本的程序代码问题，直接回滚到旧的代码即可。
- 降级，如果无法回滚代码就直接提供降级服务，比如提供默认值，或者直接提供一个维护中的告示牌也算
- 紧急更新，需要强大的自动化测试，自动化发布系统，因为要更新很多的机器，毕竟分布式服务下的机器数量是千千万的。没有自动化的 CI/CD，手动一个个发布是不现实的。

## 故障预演准备工作

首先我们要建立，以用户功能为索引的服务和资源的**全视图**，使用链路追踪的 APM 系统，外加聚合度量的监控系统来构建一个完整的系统视图，这样，才能更加明白问题出在了什么地方。

然后，为每一个服务制定关键指标，并且有一套运维工具，以及**应急预案**，比如 redis 出什么问题，用什么手段解决，MySQL 出什么问题用什么手段解决，这都要有工作手册。

**制定故障的等级**，根据等级来调用不同的人，以及资源。比如小的边缘服务出问题，影响不大，直接用自动化脚本来解决就行了。比如核心服务出问题，直接调用值班的同学来解决。

故障要经常**演练**，毕竟演戏多了才能熟练不是吗

最后就是发布新的功能时，**灰度发布**是必须要做的一个流程，谁知道写的代码都是啥玩意儿。减少错误发生的范围，没问题了再全量发布。
## 故障复盘
故障处理的整个过程。就像一个 log 一样，需要详细地记录几点几分干了什么事，把故障从发生到解决的所有细节过程都记录下来。

故障原因分析。需要说明故障的原因和分析报告。

需要反思并反问至少 5 个为什么，并为这些 “为什么” 找到答案。

故障后续整改计划。需要针对上述的 “Ask 5 Whys” 说明后续如何举一反三地从根本上解决所有的问题。

## 故障整改办法
第一，优化故障获知和故障定位的时间。第二，优化故障的处理方式。第三，优化开发过程中的问题。

举一反三解决当下的故障，从一个故障举一反三的角度思考，解决当前一类的问题，**简化复杂、不合理的技术架构**、流程和组织。只有简单优雅的东西才有被改善和优化的可能。



