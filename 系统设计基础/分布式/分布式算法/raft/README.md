<!--
 * @Author: shgopher shgopher@gmail.com
 * @Date: 2024-11-02 22:37:04
 * @LastEditors: shgopher shgopher@gmail.com
 * @LastEditTime: 2024-11-12 15:59:23
 * @FilePath: /luban/系统设计基础/分布式/分布式算法/raft/README.md
 * @Descripti
 * 
 * Copyright (c) 2024 by shgopher, All Rights Reserved. 
-->
# raft

raft 是一种 multi paxos 算法。

basic paxos 麻烦的一批，而且有很多的问题，根本无法推进到实战中，所以我们在使用强一致性方案的时候通常首选的是 multi paxos 类算法，raft 算法就是一种 multi paxos 算法，并且是强一致性共识算法中的首选。

在 raft 中角色有三个
- 领导者 (一个 raft 集群中仅有一个领导者)
- 跟随者
- 候选人

有领导的时候就是领导和跟随者的关系，领导死了，就是全部都是候选人了，谁选上了就又变成了领导，其他的候选人又变成了跟随者，所以同时存在的关系最多只有两个，情景一【领导者-跟随者】，情境二【候选人】。

**raft 算法通过一切以领导者为准的方式实现一系列值的共识和各个节点日志的一致。**
## 领导选举
在初始阶段，所有节点都是跟随者的状态。

在初始阶段，raft 系统会给所有跟随节点赋予一个**随机的**超时时间，比如
- 节点 A，任期编号 0，超时时间 100ms
- 节点 B，任期编号 0，超时时间 200ms
- 节点 C，任期编号 0，超时时间 300ms

每个节点**等待领导节点心跳信号的超时时间是随机的**，一旦没有这个信号之后，它就发生了超时，这个时候，超时时间最短的节点 (这里是 A 节点) 就会**增加自己的任期，并推举自己为候选人，并且先给自己投出一票，然后给其他节点发送投票的 RPC 消息**请求他们投自己为领导人

那么这个状态就是下面这个示意图：
![raft1](./raft1.svg)

当其它节点接收到候选人 A 的请求投票的 RPC 信息之后，在编号为 1 的任期之内还没有进行过投票，那么它就会把票投给节点 A，然后增加自己的任期编号

![raft2](./raft2.svg)

如果这个候选人赢得了大部分的选票，那么它就是**本届的**领导人

这个时候，领导人会发送心跳信号 (周期性的信号) 来通知其它的节点，不要篡位，阻止他们发起新的选举。

### 节点之间的通讯
- 请求投票 RPC，**候选人**在选举环节发起，通知各个节点投票
- 日志赋值 RPC，***领导人***发起，复制日志，提供心跳信号


### 任期制度

### 选举规则

### 随机超时时间

## 日志复制

## 成员变更







